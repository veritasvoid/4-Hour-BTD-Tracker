<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Tracker Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-elevated: #282e36;
            --accent-primary: #58a6ff;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-purple: #a371f7;
            --accent-cyan: #39c5cf;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-tertiary: #6e7681;
            --border-default: #30363d;
            --border-muted: #21262d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 14px; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-default); border-radius: 4px; }

        .app-container { max-width: 1600px; margin: 0 auto; padding: 24px; }

        .nav-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 32px; padding-bottom: 20px; border-bottom: 1px solid var(--border-default);
        }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .logo-text { font-size: 1.25rem; font-weight: 600; }

        /* New: Date row + tabs on the right */
        .top-controls {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;
        }
        .date-control {
            display: flex; align-items: center; gap: 12px; background: var(--bg-secondary); padding: 10px 16px; border-radius: 10px; border: 1px solid var(--border-default);
        }
        .date-control label { font-weight: 500; color: var(--text-secondary); }
        input[type="date"] { background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 6px; padding: 6px 10px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; }

        .nav-tabs { display: flex; gap: 4px; background: var(--bg-secondary); padding: 4px; border-radius: 10px; border: 1px solid var(--border-default); }
        .nav-tab { padding: 10px 20px; border-radius: 6px; background: transparent; color: var(--text-secondary); font-weight: 500; cursor: pointer; transition: all 0.15s; display: flex; align-items: center; gap: 8px; }
        .nav-tab:hover { color: var(--text-primary); background: var(--bg-tertiary); }
        .nav-tab.active { background: var(--bg-elevated); color: var(--text-primary); }

        /* Stronger, clearly visible date colors */
        .date-colors {
            --c1: #1e3a8a20; --c2: #16653420; --c3: #6b21a820; --c4: #0d5c6320;
            --c5: #7c2d1220; --c6: #5b21b620; --c7: #991b1b20; --c8: #1e40af20;
            --c9: #14532d20; --c10: #581c8720;
        }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-default); padding: 20px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
        .input-full { grid-column: 1 / -1; }
        textarea { width: 100%; height: 140px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 8px; padding: 14px; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; resize: vertical; }

        .button-row { display: flex; gap: 10px; margin-bottom: 24px; flex-wrap: wrap; }
        .btn { padding: 10px 18px; border-radius: 8px; border: none; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; transition: all 0.15s; }
        .btn-primary { background: var(--accent-primary); color: #fff; }
        .btn-primary:hover { background: #4090e6; transform: translateY(-1px); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-default); }
        .btn-secondary:hover { background: var(--bg-elevated); }
        .btn-danger { background: transparent; color: var(--accent-red); border: 1px solid var(--border-default); }
        .btn-danger:hover { background: rgba(248,81,73,0.1); }
        .btn-success { background: transparent; color: var(--accent-green); border: 1px solid var(--border-default); }
        .btn-success:hover { background: rgba(63,185,80,0.1); }

        .status-message { padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; font-size: 0.875rem; display: none; align-items: center; gap: 10px; }
        .status-success { background: rgba(63,185,80,0.1); border: 1px solid rgba(63,185,80,0.3); color: var(--accent-green); display: flex; }
        .status-error { background: rgba(248,81,73,0.1); border: 1px solid rgba(248,81,73,0.3); color: var(--accent-red); display: flex; }
        .status-info { background: rgba(88,166,255,0.1); border: 1px solid rgba(88,166,255,0.3); color: var(--accent-primary); display: flex; }

        .results-card { background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-default); overflow: hidden; }
        .results-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--border-default); background: var(--bg-tertiary); }
        .results-title { font-size: 0.9375rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .results-count { background: var(--bg-elevated); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; color: var(--text-secondary); }

        table { width: 100%; border-collapse: collapse; font-size: 0.8125rem; }
        thead { background: var(--bg-tertiary); position: sticky; top: 0; z-index: 10; }
        th { padding: 12px 16px; text-align: left; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; font-size: 0.6875rem; letter-spacing: 0.05em; }
        td { padding: 14px 16px; border-bottom: 1px solid var(--border-muted); }

        /* Strong date row backgrounds + readable text */
        .date-row-0 { background: var(--c1) !important; }
        .date-row-1 { background: var(--c2) !important; }
        .date-row-2 { background: var(--c3) !important; }
        .date-row-3 { background: var(--c4) !important; }
        .date-row-4 { background: var(--c5) !important; }
        .date-row-5 { background: var(--c6) !important; }
        .date-row-6 { background: var(--c7) !important; }
        .date-row-7 { background: var(--c8) !important; }
        .date-row-8 { background: var(--c9) !important; }
        .date-row-9 { background: var(--c10) !important; }

        .ticker-cell { font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--accent-primary); cursor: pointer; }
        .ticker-cell:hover { color: var(--accent-cyan); }
        .price-cell.current-green { color: var(--accent-green) !important; font-weight: 600; }
        .price-cell.current-red { color: var(--accent-red) !important; font-weight: 600; }
        .change-positive { color: var(--accent-green); font-weight: 600; }
        .change-negative { color: var(--accent-red); font-weight: 600; }

        .company-info-row td { padding: 0; background: var(--bg-tertiary); }
        .company-info-content { padding: 20px 24px; display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .company-info-section { background: var(--bg-secondary); border-radius: 10px; padding: 16px; border: 1px solid var(--border-default); }
        .company-info-section h4 { font-size: 0.6875rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--accent-primary); margin-bottom: 10px; font-weight: 600; }
        .company-info-section p { color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6; }

        .loading { display: inline-block; width: 14px; height: 14px; border: 2px solid var(--border-default); border-top-color: var(--accent-primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            .top-controls { flex-direction: column; align-items: stretch; }
            .date-control { justify-content: center; }
            .input-grid { grid-template-columns: 1fr; }
            .company-info-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="nav-header">
            <div class="logo">
                <div class="logo-icon">Chart</div>
                <span class="logo-text">Stock Tracker Hub</span>
            </div>
        </header>

        <!-- NEW: Date + Tabs on the right -->
        <div class="top-controls">
            <div class="date-control">
                <label for="dataDate">Data Date</label>
                <input type="date" id="dataDate">
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showPage('comparison')" id="tab-comparison">Stock Comparison</button>
                <button class="nav-tab" onclick="showPage('insider')" id="tab-insider">Insider Tracking</button>
            </nav>
        </div>

        <!-- Stock Comparison Page -->
        <div id="page-comparison" class="page active">
            <div class="input-grid">
                <div class="card input-full"><textarea id="dataset1" placeholder="Paste your first data set here..."></textarea></div>
                <div class="card input-full"><textarea id="dataset2" placeholder="Paste your second data set here..."></textarea></div>
            </div>
            <div class="button-row">
                <button class="btn btn-primary" onclick="compareAndParse()">Compare & Parse</button>
                <button class="btn btn-secondary" onclick="refreshPrices()">Refresh Prices</button>
                <button class="btn btn-danger" onclick="clearAll()">Clear All</button>
                <button class="btn btn-success" onclick="exportToCSV()">Export CSV</button>
            </div>
            <div id="statusMessage" class="status-message"></div>
            <div class="results-card">
                <div class="results-header">
                    <h2 class="results-title">Results <span class="results-count" id="rowCount">0 rows</span></h2>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>#</th><th>Date</th><th>Ticker</th><th>Company Name</th><th>Price</th><th>Current Price</th><th>% Change</th><th></th></tr></thead>
                        <tbody id="resultsBody"></tbody>
                    </table>
                </div>
                <div id="emptyState" class="empty-state"><p>No data yet. Paste and parse to begin.</p></div>
            </div>
        </div>

        <!-- Insider Tracking Page -->
        <div id="page-insider" class="page">
            <div class="button-row">
                <button class="btn btn-secondary" onclick="refreshInsiderPrices()">Refresh Prices</button>
                <button class="btn btn-success" onclick="exportInsiderCSV()">Export CSV</button>
            </div>
            <div id="insiderStatusMessage" class="status-message"></div>
            <div class="results-card">
                <div class="results-header">
                    <h2 class="results-title">Insider Buy Alerts <span class="results-count" id="insiderRowCount">0 rows</span></h2>
                </div>
                <div class="table-container">
                    <table>
                        <thead><tr><th>#</th><th>Date</th><th>Ticker</th><th>Company</th><th>News</th><th>Insider</th><th>Amount</th><th>Alert Price</th><th>Current Price</th><th>% Change</th></tr></thead>
                        <tbody id="insiderResultsBody"></tbody>
                    </table>
                </div>
                <div id="insiderEmptyState" class="empty-state"><p>No insider trades loaded yet.</p></div>
            </div>
        </div>
    </div>

    <script>
        // ... [All your existing JS stays exactly the same until renderTable() and renderInsiderTable()]

        // ONLY MODIFIED PARTS BELOW:

        const dateColors = ['var(--c1)','var(--c2)','var(--c3)','var(--c4)','var(--c5)','var(--c6)','var(--c7)','var(--c8)','var(--c9)','var(--c10)'];
        let dateColorMap = {}, colorIndex = 0;
        function getDateColor(date) {
            if (!dateColorMap[date]) dateColorMap[date] = dateColors[colorIndex++ % dateColors.length];
            return dateColorMap[date];
        }

        function renderTable() {
            const tbody = document.getElementById('resultsBody');
            const empty = document.getElementById('emptyState');
            document.getElementById('rowCount').textContent = parsedData.length + ' rows';
            if (!parsedData.length) { tbody.innerHTML = ''; empty.style.display = 'block'; return; }
            empty.style.display = 'none';

            tbody.innerHTML = parsedData.map((item, i) => {
                const change = calculateChange(item.price, item.currentPrice);
                const changeClass = change !== null ? (change >= 0 ? 'change-positive' : 'change-negative') : '';
                const changeText = change !== null ? (change >= 0 ? '+' : '') + change.toFixed(2) + '%' : '—';

                const currentPriceClass = item.currentPrice && item.currentPrice > item.price ? 'current-green' : item.currentPrice && item.currentPrice < item.price ? 'current-red' : '';
                const currentPriceText = item.currentPrice === null ? '<span class="loading"></span>' :
                                        item.currentPrice === 'manual' ? `<input type="number" step="0.01" class="price-input" placeholder="Enter" onchange="updateCurrentPrice(${item.id},this.value)">` :
                                        `$${parseFloat(item.currentPrice).toFixed(2)}`;

                const colorVar = getDateColor(item.date);
                const rowClass = `date-row-${Object.keys(dateColorMap).indexOf(item.date) % 10}`;

                let html = `<tr class="${rowClass}"><td>${i+1}</td><td><input type="date" class="date-input" value="${item.date}" onchange="updateDate(${item.id},this.value)"></td>
                    <td class="ticker-cell ${item.expanded?'expanded':''}" onclick="toggleCompanyInfo(${item.id})">${item.ticker}</td>
                    <td>${item.companyName}</td><td class="price-cell">$${item.price.toFixed(2)}</td>
                    <td class="price-cell ${currentPriceClass}">${currentPriceText}</td>
                    <td class="${changeClass}">${changeText}</td>
                    <td><button class="btn-remove" onclick="removeRow(${item.id})">X</button></td></tr>`;

                if (item.expanded) {
                    html += `<tr class="company-info-row"><td colspan="8"><div class="company-info-content" id="company-info-${item.id}">
                        ${item.companyInfo ? renderCompanyInfo(item) : '<div class="company-info-loading"><span class="loading"></span> Loading analysis...</div>'}
                    </div></td></tr>`;
                }
                return html;
            }).join('');
        }

        function renderInsiderTable() {
            const tbody = document.getElementById('insiderResultsBody');
            const empty = document.getElementById('insiderEmptyState');
            document.getElementById('insiderRowCount').textContent = insiderData.length + ' rows';
            if (!insiderData.length) { tbody.innerHTML = ''; empty.style.display = 'block'; return; }
            empty.style.display = 'none';

            tbody.innerHTML = insiderData.map((item, i) => {
                const change = item.alertPrice && item.currentPrice ? ((item.currentPrice - item.alertPrice) / item.alertPrice) * 100 : null;
                const changeClass = change !== null ? (change >= 0 ? 'change-positive' : 'change-negative') : '';
                const changeText = change !== null ? (change >= 0 ? '+' : '') + change.toFixed(2) + '%' : '—';
                const currentPriceClass = item.currentPrice && item.currentPrice > item.alertPrice ? 'current-green' : item.currentPrice && item.currentPrice < item.alertPrice ? 'current-red' : '';
                const colorVar = getDateColor(item.date);
                const rowClass = `date-row-${Object.keys(dateColorMap).indexOf(item.date) % 10}`;

                return `<tr class="${rowClass}">
                    <td>${i+1}</td><td>${item.date}</td>
                    <td class="ticker-cell" onclick="toggleInsiderInfo(${i})">${item.ticker}</td>
                    <td>${item.companyName}</td><td class="news-cell">${item.news}</td>
                    <td>${item.insider ? `<span class="insider-badge">${item.insider}</span>` : '—'}</td>
                    <td class="amount-cell">${item.amount || '—'}</td>
                    <td class="price-cell">$${item.alertPrice?.toFixed(2) || '—'}</td>
                    <td class="price-cell ${currentPriceClass}">${item.currentPrice ? '$'+item.currentPrice.toFixed(2) : '<span class="loading"></span>'}</td>
                    <td class="${changeClass}">${changeText}</td>
                </tr>
                ${item.expanded ? `<tr class="company-info-row"><td colspan="10"><div class="company-info-content">`+
                    (item.analysis ? `<div class="company-info-section"><h4>Grok Analysis</h4><pre style="white-space: pre-wrap; font-family: inherit;">${item.analysis}</pre></div>` : '<div class="company-info-loading"><span class="loading"></span> Loading Grok analysis...</div>')+
                `</div></td></tr>` : ''}`;
            }).join('');
        }

        function toggleInsiderInfo(index) {
            const item = insiderData[index];
            item.expanded = !item.expanded;
            if (item.expanded && !item.analysis) fetchGrokAnalysis(item.ticker, index);
            renderInsiderTable();
        }

        async function fetchGrokAnalysis(ticker, index) {
            // Replace with your actual Grok API endpoint when ready
            const placeholder = `**${ticker}**\nSector: Tech / Semiconductors\nWhat it does: Leading designer of GPUs and AI chips.\n\n**Bottom Line:** Yes, buy the dip – 19% off highs, strong AI demand, 30% upside.\n**Buy the dip: Yes — 80% certainty**`;
            setTimeout(() => {
                insiderData[index].analysis = placeholder;
                renderInsiderTable();
            }, 800);
        }

        // Rest of your existing JS stays 100% unchanged
        // (loadFromGoogleSheets, compareAndParse, etc.)

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('dataDate').value = new Date().toISOString().split('T')[0];
            loadFromGoogleSheets();
        });

        // Keep all your existing functions (showPage, fetchCurrentPrices, etc.) unchanged
        // ... [rest of your original script]
    </script>
</body>
</html>